# 信息安全

**信息安全的核心目标：CIA模型保护**

- Confidentiality（机密性）：私密的数据不能透露给非授权的个体
- Integrity（完整性）：信息和程序不能收到故意或无意的非授权操纵
- Availability（可用性）：系统必须及时的提供服务，不能拒绝向授权用户提供服务

| 核心目标 | 说明 |
| :-- | :-- |
| 机密性 | 通过加密技术使信息在存诸、传输、使用的过程中，不会被<font color="red">泄漏</font>给非授权用户或实体 |
| 完整性 | 指信息再存储、传输、使用的过程中，不会被非授权用户<font color="red">篡改</font>或防止授权用户对信息进行不恰当的篡改 |
| 可用性 | 指确保授权用户或实体对信息资源的正常使用不会被<font color="red">异常</font>拒绝，允许其可靠而及时地访问信息资源 |

## PKI公钥基础架构

Public Key Infrastructure（公钥基础结构），通过*公钥技术* 与*数字证书* 确保信息安全体系，这两者又由*公钥加密技术*、*数字证书*、*CA*、*RA* 等共同组成，PKI体系能够实现的功能有：*机密性*、*完整性*、*身份验证*、*不可否认性*

### 机密性技术

**加密技术简介**

- 明文：需要被隐蔽的信息
- 密文：明文经过变换后形成的隐蔽形式
- 加密：把明文转化为密文的过程
- 解密：把密文还原成明文的过程
- 密钥：在加密或解密的算法中输入的参数
- 加密算法分为两类：对称加密算法和非对称加密算法

#### 加密技术分类

**根据密钥的使用方法**

- 对称加密：加密、解密使用相同的密钥；特点是加密速度快、密文紧凑（明文文件与加密后密文文件大小相差不多）、大型环境下密钥管理复杂（例如电商，一个用户就需要一套密钥）、用于大量数据的传输；生活中汽车钥匙、房屋钥匙都需要使用相同的钥匙打开，即对称加密方式

  | 算法 | 密钥 | 开发者 | 补充 |
  | :-: | :-: | :-: | :-: |
  | 数据加密标准DES | 56位 | IBM为美国政府(NBS/NIST)开发 | 很多政府强制性使用 |
  | 3DES | 3*56位 | IBM为美国政府(NBS/NIST)开发 | 应用3次DES |
  | CAST | 40-256位可变 | 北方通信 | 比DES稍快 |
  | Rivest算法(RC2) | 可变 | Ron Rivest（RSA数据安全） | 专利细节未公开 |
  | RC5 | | Ron Rivest(RSA数据安全) | |
  | AES | | Joan Daemen/Vincent Riimen | |

  DES全称Data Encryption Standard，在密码技术里需要对encrypt这个单词敏感，它代表加密，与之相对应的decrypt代表解密，3DES又称为TripleDES；现在在对称密钥里用的比较多的技术是AES（Advanced Encryption Standard，高级加密标准），AES是一种区块加密标准，用于代替早期的DES

- 非对称加密：加密、解密使用不同的密钥（公钥、私钥）；特点是速度慢、密文不紧凑、密钥管理简单、通常只用于数字签名。由于非对称加密速度慢、密文不紧凑（1G数据加密后的密文可能有3G或更大）特点，因此非对称加密一般不用于加密实际数据，而用于密钥管理和数字签名；非对称加密的使用方式专注8个字：*公加私解、私加公解*

  非对称加密会产生一副密钥对，私钥个人保存、公钥随意分发。公加私解表示用公钥对明文进行加密，只能用对应的私钥进行解密，电商就是典型的公加私解的应用，例如个人浏览器访问京东，就能拿到京东的公钥，在浏览器上查看京东站点的证书信息就能够查看到京东的公钥，通过京东的公钥将个人信息加密后发送到京东；私加公解主要用于数字签名，公加私解很好理解，通过公钥加密的客户端数据只能通过服务端私钥解密，正常情况下*私钥只会个人拥有*，那么反向思考，通过私钥加密的数据可以通过公钥解密，如果公钥能够成功解密，说明该数据肯定来自于服务端

  **公钥加密算法**

  | 算法 | 设计者 | 用途 | 安全性 |
  | :-: | :-: | :-: | :-: |
  | RSA | RSA数据安全 | 加密<br />数字签名<br />密钥交换 | 大数分解 |
  | DSA | NSA | 数字签名 | 离散对数 |
  | DH | Diffie&Hellman | 密钥交换 | 完全向前保密 |

  一般情况下对称加密算法会和非对称加密算法结合使用，对称加密算法对明文数据进行加密，它的密钥会被当做数据本身，然后通过非对称加密算法对其密钥加密后进行传递

不论是对称加密或非对称加密都涉及到*密钥长度*，密钥长度越长加密数据越安全，但不同算法之间的密钥长度不可以互相比较，不同的算法其本身的安全性可能就已经天差地别，不可单纯靠密钥长度进行对比

密码与信息安全常识

<table>
  <tr>
    <td>不要使用任何非公开的加密算法</td>
    <td>只有公开的加密算法，经过全世界的破译者（黑客）来对该算法的验证，才能证明其强度，经得起推敲的算法才具备更高的安全性、可靠性</td>
  <tr>
  <tr>
    <td>使用低强度密码比不加密更危险</td>
    <td>不要产生认为有密码就安全的错觉</td>
  </tr>
  <tr>
    <td>任何密码总有一天会被破解</td>
    <td>尝试所有密钥，除非是量子密码或一次性密码本</td>
  </tr>
  <tr>
    <td>密码只是信息安全的一部分</td>
    <td>社会工程学（social engineering），人类本身才是最脆弱的</td>
  </tr>
</table> 

#### 公钥加密技术（非对称加密技术）

非对称加密也叫公钥加密，是PKI的基础。公钥（Public Key）和私钥（Private Key）是成对生成、互不相同，可以互相加密和解密，根据一个密钥无法推算出另外一个密钥，公钥公开、私钥保密（只有持有人知晓），私钥应由密钥持有人妥善保管。公钥加密根据实现的功能不同，可以分为数据加密和数字签名

**数字信封**：发送方采用接收方的公钥来加密对称密钥。发送方的对称密钥加密后产生的数据就是数字信封，采用数字信封时，接收方需要使用自己的私钥才能打开数字信封得到对称密钥，得到发送方的对称密钥后再通过对称密钥对发送方的密文进行解密

![数字信封](https://www.z4a.net/images/2024/06/26/259cd6b15554f78d4a5adf72d9483ce6.png)

数字信封结合了对称加密算法和非对称加密算法两者各自的优势

**两种算法的结合**

在上面的数字信封中也只是为了便于理解，使用公钥来加密对称密钥进行传输，在实际使用中通常不会这么做，实际使用中，通信双方通常会<font color="red">使用公钥密码学（非对称加密）来交换密钥素材</font>，双方通过交换各自的密钥素材各自计算得出相同的密钥，而<font color="red">用对称密码学（对称加密）来加密实际的数据</font>，两者配合使用，<font color="red">保证了加密速度和安全性</font>

交换素材的过程实际上也就是使用了非对称加密技术中的DH算法，DH算法本身具备多个版本号，考虑到老旧设备的兼容性问题，建议使用DH算法时至少使用版本2以上

![两种算法的结合](https://www.z4a.net/images/2024/06/27/14de70daa5fa282a16a73e9bc4731ce8.png)

但两种算法结合的流程仍存在2个问题：

1. 假设黑客拦截了发送者的*密文文件* 和*数字信封*，然后黑客利用自己的对称密钥和接收者的公钥，重新生成一份新的密文文件和数字信封，并发送给接收者，那么接收者应当如何判断自己收到的密文文件和数字信封，到底是发送者的数据还是黑客的数据呢？因此需要身份验证
2. 假设黑客即便只拦截了发送者的*密文文件*，黑客对密文文件进行修改后再转发给接收者，那么接收者收到的密文文件能否成功解密？解密后的数据如何判断真假？因此需要保证数据的真实性和完整性

### 完整性技术

完整性技术又称为信息摘要或单向散列函数、哈希（Hash）等名称。它能够将任意长的字符串通过哈希计算出固定长度字符串，类似指纹、DNA，特点是不可逆、雪崩效应（对明文数据的任意变化都会导致哈希计算结果天差地别）

**完整性技术的算法**

| 项目 | MD5 | SHA1 | SHA2 |
| :-: | :-: | :-: | :-: | 
| 全称 | Message Digest 5 | Secure Hash Algorithm 1 | Secure Hash Algorithm 2 |
| 签名长度 | 128位 | 160位 | SHA2-256：256位<br />SHA2-384：384位<br />SHA2-512：512位 |
| 安全级别 | 低 | 中 | 高 |

签名长度使用2进制衡量，即便是安全级别最低的128位也至少代表了一个IPv6的长度，这个值可以计算到3.4*10^38，位数越大则能够计算出的结果就越多；我们不能期望一个东西是无限长的，哈希算法是定长的，所以哈希计算结果是有限的，但数据是无限的，因此总能找到两个不同的数据，他们的哈希值是一样的

大多数时候会在各种场景下感受到“哈希加密”的使用，例如在交换机上创建用户设置密码后，再查看配置信息是就会看到明文密码信息被“哈希加密”了，本质上哈希值只是用于隐藏真实的明文密码，因此哈希算法可以用在加密的领域里，但严格来说哈希它并不属于对称加密或非对称加密算法，它并不会产生密钥，通常建议在数据库中只保留用户的密码哈希值，这样子即便数据库被黑客破解，也可以最大限度的防止黑客对用户的数据产生更大的破坏

在交换机上看到的用户密码的“密文信息”也只是对明文密码进行哈希计算后产生的哈希值，用户再次登陆输入明文密码时，交换机仍会在对输入的明文密码进行哈希计算，如果键入的密码哈希值与交换机数据库中的哈希值一致，则代表密码正确

> 暴力破解：尝试所有密码组合
>
> 字典破解：在字典（模板）中收集各种常见的密码，字典越大，密码越多，破解越快
>
> 黑客破解网站后拿到用户信息，这些用户隐私信息可以用于广告投入、大数据分析等作用，同时这些用户信息里也包含有用户密码，这些密码就可以补充到个人的字典中

### 数字签名

Digital Signature，发送方使用私钥对信息摘要进行加密的过程，过程中得到的密文即称为签名信息。发送方将签名信息与原始数据发送给接收方，接收方对原始数据进行摘要计算，得出的值与签名信息进行比对，保证数据的完整性、身份验证和不可否认

**数字签名流程**

1. 发送方对明文文件的摘要信息进行哈希计算，得出哈希值
2. 发送方使用自己的私钥对摘要信息的哈希值进行加密，得出的密文就是签名信息
3. 发送方将数字签名和明文文件一同发送给接收方
4. 接收方收到数据后，通过发送方的公钥对签名信息进行解密，得到发送方的摘要信息的哈希值
5. 接收方对收到的明文数据的摘要信息进行哈希计算，得出哈希值
6. 将从发送方收到的解密后的哈希值与接收方自身计算得出的哈希值做对比

为了便于理解，数字签名的整个流程中，都是直接称呼的明文数据，但实际上明文数据也是经过加密的，明文数据一般会使用对称密钥进行加密，下例图示中只是描述出公加私解、私加公解两种方式的用法

![数字签名](https://www.z4a.net/images/2024/06/28/b96628c453a0f48e40af1474dea41f5e.png)

数字签名就已经解决了数字信封关于身份验证和完整性的问题，但数字签名的流程中仍存在一个问题：接收者如何保证自己手里的公钥，就是发送者的公钥呢？

### 证书

**公钥技术的规模应用难题**

- 如何解决公钥的传播问题
  - 如何把自己的公钥告诉别人
  - 得到一个公钥后如何验证其真实性
- 公钥如何管理
- 如何实现不可否认服务

**证书**

- 证书用于保证密钥的合法性
- 证书的主体可以是用户、计算机、服务等
- 证书格式遵循X.509（v3）标准
- 数字证书包含信息
  - 使用者的公钥值
  - 使用者标识信息（如名称和电子邮件地址）
  - 有效期（证书的有效时间）
  - 颁发者标识信息
  - 颁发者的数字签名
- 数字证书由权威公正的第三方机构即CA签发

**CA的作用**

- Certificate Authority，证书颁发机构
- CA的核心功能是颁发和管理数字证书
- CA的作用
  - 处理证书申请
  - 发放证书
  - 更新证书
  - 接受最终用户数字证书的查询、撤销
  - 产生和发布证书吊销列表（CRL）
  - 数字证书归档
- 如果把证书比作身份证，CA就是公安局

在数字世界里，接收者可以通过CA来确认发送者的公钥是否真实可信，那么如何确定CA本身是否真实可信呢？微软操作系统上默认记录了一些全球知名CA地址，通过Edge浏览器`更多工具->Internet选项->内容->证书->守新人的根证书颁发机构`，可以查看系统内置的CA机构，操作系统访问由这些CA颁发了证书的站点，在浏览器的链接栏里可以观察到信息提示“连接是安全的”。如果访问一些非受信任的CA颁发的证书的站点，浏览器会提示“你的连接不是私密连接”或“此站点不安全”，windows运行`certmgr.msc`可以查看本地证书

> 关于银行U盾
>
> 一般情况下打开银行的登陆站点，https的链接已经校验的网站的身份和其他信息，在没有U盾的情况下，用户身份信息登陆银行站点无法执行一下高权限操作，例如转账，插入U盾后访问银行网站才具备高操作权限，U盾内基本上就是保存由银行颁发给客户的证书，在用户访问银行站点时，通过https校验了银行的身份信息，反之银行也需要校验客户的身份信息，这是为了避免用户因身份信息泄露导致账户异常高危操作，U盾内的这种类型的证书不需要到公网进行验证，只需要银行站点能校验通过即可

**PKI协议**

- SSL（Secure Sockets Layer，安全套接层）
  - 认证用户和服务器，确保数据发送到正确的客户机和服务器
  - 加密数据以防止数据中途被窃取
  - 维护数据的完整性，确保数据在传输过程中不被改变
- HTTPS（Hypertext Transfer Protocol Secure）
  - 使用SSL来实现安全的通信
- IPSec（Internet Protocol Security）
  - 目前主流的的VPN解决方案

**小结**

| 术语 | 说明 |
| :-- |:--|
| 数字信封 | 结合对称和非对称加密，保证数据传输的机密性 |
| 数字签名 | 采用散列算法（Hash），保证数据传输的完整性 |
| 数字证书 | 通过第三方权威机构（CA）对公钥进行公证，保证数据传输的不可否认性 |