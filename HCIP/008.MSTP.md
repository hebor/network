# MSTP

RSTP在STP基础上进行了改进，实现了网络拓扑快速收敛。但由于局域网内所有的VLAN共享一棵生成树，因此被阻塞后链路将不承载任何流量，无法在VLAN间实现数据流量的负载均衡，从而造成带宽浪费。为了弥补STP和RSTP的缺陷，IEEE于2002年发布的802.1s标准定义了MSTP。MSTP兼容STP和RSTP，既可以快速收敛，又提供了数据转发的多个冗余路径，在数据转发过程中实现VLAN数据的负载均衡

MSTP的改动只关系到网络结构的设计，相较STP和RSTP的数据包没有变化

**STP、RSTP的问题**

- Trunk链路上实际上运行着多个VLAN
- 所有VLAN共用一颗生成树
- 无法实现不同VLAN再多条Trunk链路上的负载分担

![STP、RSTP的问题](https://www.z4a.net/images/2024/06/12/STPRSTP.png)

PCA或者说VLAN10的所有流量都要经过SWC绕路，这本身就不是一个最优路径，如果VLAN10的业务流量非常大，更会加大SWC的负载压力，而SWB与SWA直接互联的链路处于空挡，浪费带宽资源

**MSTP：<font color="red">Multiple STP，多生成树协议</font>**

- 设置VLAN映射表，将一个或多个VLAN映射到一个多生成树<font color="red">实例（Instance）</font>上
- 基于<font color="red">实例计算出多颗生成树</font>，实例间实现负载分担
- 具有RSTP快速收敛的特性，且兼容STP和RSTP

![MSTP多实例](https://www.z4a.net/images/2024/06/12/MSTP.png)